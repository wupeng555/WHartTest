import{_ as a,c as i,o as n,ae as e}from"./chunks/framework.BBQ6_s69.js";const c=JSON.parse('{"title":"GitHub 自动构建 Docker 镜像部署指南","description":"","frontmatter":{},"headers":[],"relativePath":"github-docker-deployment.md","filePath":"github-docker-deployment.md","lastUpdated":1761897499000}'),l={name:"github-docker-deployment.md"};function t(h,s,p,o,k,r){return n(),i("div",null,s[0]||(s[0]=[e(`<h1 id="github-自动构建-docker-镜像部署指南" tabindex="-1">GitHub 自动构建 Docker 镜像部署指南 <a class="header-anchor" href="#github-自动构建-docker-镜像部署指南" aria-label="Permalink to &quot;GitHub 自动构建 Docker 镜像部署指南&quot;">​</a></h1><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to &quot;概述&quot;">​</a></h2><p>本项目已配置 GitHub Actions 自动构建流程，可以自动将代码构建为 Docker 镜像并推送到 GitHub Container Registry (GHCR)。用户可以直接拉取预构建的镜像，无需本地构建。</p><h2 id="工作流程" tabindex="-1">工作流程 <a class="header-anchor" href="#工作流程" aria-label="Permalink to &quot;工作流程&quot;">​</a></h2><h3 id="_1-自动构建触发条件" tabindex="-1">1. 自动构建触发条件 <a class="header-anchor" href="#_1-自动构建触发条件" aria-label="Permalink to &quot;1. 自动构建触发条件&quot;">​</a></h3><ul><li>推送代码到 <code>main</code> 分支</li><li>创建版本标签 (如 <code>v1.0.0</code>)</li><li>创建 Pull Request</li></ul><h3 id="_2-构建的镜像" tabindex="-1">2. 构建的镜像 <a class="header-anchor" href="#_2-构建的镜像" aria-label="Permalink to &quot;2. 构建的镜像&quot;">​</a></h3><p>GitHub Actions 会自动构建并推送以下三个镜像：</p><ul><li><code>ghcr.io/YOUR_USERNAME/wharttest-backend:latest</code> - Django 后端</li><li><code>ghcr.io/YOUR_USERNAME/wharttest-frontend:latest</code> - Vue 前端</li><li><code>ghcr.io/YOUR_USERNAME/wharttest-mcp:latest</code> - MCP 服务</li></ul><h3 id="_3-镜像标签策略" tabindex="-1">3. 镜像标签策略 <a class="header-anchor" href="#_3-镜像标签策略" aria-label="Permalink to &quot;3. 镜像标签策略&quot;">​</a></h3><ul><li><code>latest</code> - main 分支的最新版本</li><li><code>v1.0.0</code> - 具体版本号</li><li><code>main</code> - main 分支标签</li><li><code>pr-123</code> - Pull Request 标签</li></ul><h2 id="初次设置步骤" tabindex="-1">初次设置步骤 <a class="header-anchor" href="#初次设置步骤" aria-label="Permalink to &quot;初次设置步骤&quot;">​</a></h2><h3 id="_1-启用-github-packages" tabindex="-1">1. 启用 GitHub Packages <a class="header-anchor" href="#_1-启用-github-packages" aria-label="Permalink to &quot;1. 启用 GitHub Packages&quot;">​</a></h3><ol><li>进入你的 GitHub 仓库</li><li>进入 <strong>Settings</strong> &gt; <strong>Actions</strong> &gt; <strong>General</strong></li><li>确保 <strong>Workflow permissions</strong> 设置为 <strong>Read and write permissions</strong></li><li>保存设置</li></ol><h3 id="_2-修改镜像地址" tabindex="-1">2. 修改镜像地址 <a class="header-anchor" href="#_2-修改镜像地址" aria-label="Permalink to &quot;2. 修改镜像地址&quot;">​</a></h3><p>镜像地址已经配置为：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  backend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ghcr.io/mg-duan/wharttest-backend:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  frontend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ghcr.io/mg-duan/wharttest-frontend:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  mcp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ghcr.io/mg-duan/wharttest-mcp:latest</span></span></code></pre></div><h3 id="_3-设置镜像为公开-可选" tabindex="-1">3. 设置镜像为公开（可选） <a class="header-anchor" href="#_3-设置镜像为公开-可选" aria-label="Permalink to &quot;3. 设置镜像为公开（可选）&quot;">​</a></h3><p>默认情况下，镜像是私有的。如果希望公开访问：</p><ol><li>进入 GitHub 仓库页面</li><li>点击右侧的 <strong>Packages</strong></li><li>选择对应的包（backend/frontend/mcp）</li><li>点击 <strong>Package settings</strong></li><li>滚动到 <strong>Danger Zone</strong></li><li>点击 <strong>Change visibility</strong> 设置为 <strong>Public</strong></li></ol><h2 id="使用方式" tabindex="-1">使用方式 <a class="header-anchor" href="#使用方式" aria-label="Permalink to &quot;使用方式&quot;">​</a></h2><h3 id="开发环境-本地构建" tabindex="-1">开发环境（本地构建） <a class="header-anchor" href="#开发环境-本地构建" aria-label="Permalink to &quot;开发环境（本地构建）&quot;">​</a></h3><p>使用默认的 <code>docker-compose.yml</code>，会在本地构建镜像：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span></span></code></pre></div><h3 id="生产环境-使用预构建镜像" tabindex="-1">生产环境（使用预构建镜像） <a class="header-anchor" href="#生产环境-使用预构建镜像" aria-label="Permalink to &quot;生产环境（使用预构建镜像）&quot;">​</a></h3><h4 id="方法一-使用-docker-compose-prod-yml" tabindex="-1">方法一：使用 docker-compose.prod.yml <a class="header-anchor" href="#方法一-使用-docker-compose-prod-yml" aria-label="Permalink to &quot;方法一：使用 docker-compose.prod.yml&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 复制环境变量配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env.example</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 编辑 .env 文件，设置必要的环境变量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 特别是 DJANGO_SECRET_KEY 和 DJANGO_ADMIN_PASSWORD</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 使用生产配置启动</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-compose.prod.yml</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span></span></code></pre></div><h4 id="方法二-修改-docker-compose-yml" tabindex="-1">方法二：修改 docker-compose.yml <a class="header-anchor" href="#方法二-修改-docker-compose-yml" aria-label="Permalink to &quot;方法二：修改 docker-compose.yml&quot;">​</a></h4><p>在 <code>docker-compose.yml</code> 中注释掉 <code>build</code> 部分，取消注释 <code>image</code> 行：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  backend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # build:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #   context: ./WHartTest_Django</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #   dockerfile: Dockerfile</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ghcr.io/your-github-username/wharttest-backend:latest</span></span></code></pre></div><p>然后运行：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span></span></code></pre></div><h3 id="使用特定版本" tabindex="-1">使用特定版本 <a class="header-anchor" href="#使用特定版本" aria-label="Permalink to &quot;使用特定版本&quot;">​</a></h3><p>如果要使用特定版本而不是 <code>latest</code>：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  backend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ghcr.io/mg-duan/wharttest-backend:v1.0.0</span></span></code></pre></div><h2 id="验证部署" tabindex="-1">验证部署 <a class="header-anchor" href="#验证部署" aria-label="Permalink to &quot;验证部署&quot;">​</a></h2><h3 id="查看容器状态" tabindex="-1">查看容器状态 <a class="header-anchor" href="#查看容器状态" aria-label="Permalink to &quot;查看容器状态&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span></span></code></pre></div><h3 id="查看日志" tabindex="-1">查看日志 <a class="header-anchor" href="#查看日志" aria-label="Permalink to &quot;查看日志&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看所有容器日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看特定服务日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backend</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frontend</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mcp</span></span></code></pre></div><h3 id="访问服务" tabindex="-1">访问服务 <a class="header-anchor" href="#访问服务" aria-label="Permalink to &quot;访问服务&quot;">​</a></h3><ul><li>前端: <code>http://localhost</code></li><li>后端 API: <code>http://localhost:8000/api/</code></li><li>Django Admin: <code>http://localhost:8000/admin/</code></li><li>MCP Tools: <code>http://localhost:8006</code></li><li>MS MCP API: <code>http://localhost:8007</code></li></ul><h2 id="私有镜像认证" tabindex="-1">私有镜像认证 <a class="header-anchor" href="#私有镜像认证" aria-label="Permalink to &quot;私有镜像认证&quot;">​</a></h2><p>如果镜像是私有的，需要先登录 GitHub Container Registry：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 创建 Personal Access Token (PAT)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#    - 进入 GitHub Settings &gt; Developer settings &gt; Personal access tokens &gt; Tokens (classic)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#    - 点击 &quot;Generate new token (classic)&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#    - 选择 read:packages 权限</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#    - 生成并复制 token</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 使用 token 登录</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> YOUR_PAT_TOKEN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> login</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ghcr.io</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mg-duan</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --password-stdin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 现在可以拉取私有镜像了</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-compose.prod.yml</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-compose.prod.yml</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span></span></code></pre></div><h2 id="手动拉取最新镜像" tabindex="-1">手动拉取最新镜像 <a class="header-anchor" href="#手动拉取最新镜像" aria-label="Permalink to &quot;手动拉取最新镜像&quot;">​</a></h2><p>如果 GitHub 已经构建了新版本，本地想更新：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 拉取最新镜像</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-compose.prod.yml</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启容器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-compose.prod.yml</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span></span></code></pre></div><h2 id="查看-github-actions-构建状态" tabindex="-1">查看 GitHub Actions 构建状态 <a class="header-anchor" href="#查看-github-actions-构建状态" aria-label="Permalink to &quot;查看 GitHub Actions 构建状态&quot;">​</a></h2><ol><li>进入 GitHub 仓库</li><li>点击 <strong>Actions</strong> 标签</li><li>查看 <strong>Build and Push Docker Images</strong> 工作流</li><li>点击具体的运行记录查看详细日志</li></ol><h2 id="版本发布流程" tabindex="-1">版本发布流程 <a class="header-anchor" href="#版本发布流程" aria-label="Permalink to &quot;版本发布流程&quot;">​</a></h2><h3 id="发布新版本" tabindex="-1">发布新版本 <a class="header-anchor" href="#发布新版本" aria-label="Permalink to &quot;发布新版本&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 确保代码已提交</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> commit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;release: version 1.0.0&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 创建版本标签</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1.0.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 推送代码和标签</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> main</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1.0.0</span></span></code></pre></div><p>GitHub Actions 会自动：</p><ul><li>构建三个服务的 Docker 镜像</li><li>推送到 GHCR，包含 <code>latest</code> 和 <code>v1.0.0</code> 标签</li></ul><h2 id="故障排除" tabindex="-1">故障排除 <a class="header-anchor" href="#故障排除" aria-label="Permalink to &quot;故障排除&quot;">​</a></h2><h3 id="问题-拉取镜像失败" tabindex="-1">问题：拉取镜像失败 <a class="header-anchor" href="#问题-拉取镜像失败" aria-label="Permalink to &quot;问题：拉取镜像失败&quot;">​</a></h3><p><strong>原因</strong>：镜像是私有的，需要认证</p><p><strong>解决</strong>：按照&quot;私有镜像认证&quot;部分的步骤登录 GHCR</p><h3 id="问题-github-actions-构建失败" tabindex="-1">问题：GitHub Actions 构建失败 <a class="header-anchor" href="#问题-github-actions-构建失败" aria-label="Permalink to &quot;问题：GitHub Actions 构建失败&quot;">​</a></h3><p><strong>检查</strong>：</p><ol><li>进入 Actions 页面查看错误日志</li><li>确认 Workflow permissions 设置正确</li><li>检查 Dockerfile 是否有语法错误</li></ol><h3 id="问题-容器启动失败" tabindex="-1">问题：容器启动失败 <a class="header-anchor" href="#问题-容器启动失败" aria-label="Permalink to &quot;问题：容器启动失败&quot;">​</a></h3><p><strong>检查</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看容器日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backend</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> frontend</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mcp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查环境变量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env</span></span></code></pre></div><h2 id="环境变量配置" tabindex="-1">环境变量配置 <a class="header-anchor" href="#环境变量配置" aria-label="Permalink to &quot;环境变量配置&quot;">​</a></h2><p>生产环境必须修改的环境变量（在 <code>.env</code> 文件中）：</p><div class="language-env vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">env</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># Django 配置</span></span>
<span class="line"><span>DJANGO_SECRET_KEY=your-secret-key-here  # 必须修改！</span></span>
<span class="line"><span>DJANGO_DEBUG=False</span></span>
<span class="line"><span>DJANGO_ADMIN_PASSWORD=your-secure-password  # 必须修改！</span></span>
<span class="line"><span>DJANGO_ALLOWED_HOSTS=your-domain.com,www.your-domain.com</span></span>
<span class="line"><span></span></span>
<span class="line"><span># CORS 配置</span></span>
<span class="line"><span>DJANGO_CORS_ALLOWED_ORIGINS=https://your-domain.com</span></span>
<span class="line"><span></span></span>
<span class="line"><span># MCP 配置（如果使用）</span></span>
<span class="line"><span>WHARTTEST_API_KEY=your-api-key</span></span></code></pre></div><h2 id="清理资源" tabindex="-1">清理资源 <a class="header-anchor" href="#清理资源" aria-label="Permalink to &quot;清理资源&quot;">​</a></h2><h3 id="停止并删除容器" tabindex="-1">停止并删除容器 <a class="header-anchor" href="#停止并删除容器" aria-label="Permalink to &quot;停止并删除容器&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> down</span></span></code></pre></div><h3 id="删除镜像" tabindex="-1">删除镜像 <a class="header-anchor" href="#删除镜像" aria-label="Permalink to &quot;删除镜像&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ghcr.io/your-github-username/wharttest-backend:latest</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ghcr.io/your-github-username/wharttest-frontend:latest</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ghcr.io/your-github-username/wharttest-mcp:latest</span></span></code></pre></div><h3 id="清理构建缓存" tabindex="-1">清理构建缓存 <a class="header-anchor" href="#清理构建缓存" aria-label="Permalink to &quot;清理构建缓存&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> system</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prune</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span></span></code></pre></div><h2 id="性能优化" tabindex="-1">性能优化 <a class="header-anchor" href="#性能优化" aria-label="Permalink to &quot;性能优化&quot;">​</a></h2><h3 id="使用多阶段构建缓存" tabindex="-1">使用多阶段构建缓存 <a class="header-anchor" href="#使用多阶段构建缓存" aria-label="Permalink to &quot;使用多阶段构建缓存&quot;">​</a></h3><p>GitHub Actions 已配置使用 GitHub Actions Cache 进行层缓存，加快构建速度。</p><h3 id="镜像大小优化" tabindex="-1">镜像大小优化 <a class="header-anchor" href="#镜像大小优化" aria-label="Permalink to &quot;镜像大小优化&quot;">​</a></h3><p>所有 Dockerfile 已使用多阶段构建，生产镜像较小：</p><ul><li>Backend: ~200-300 MB</li><li>Frontend: ~50-80 MB (nginx + 静态文件)</li><li>MCP: ~150-200 MB</li></ul><h2 id="安全建议" tabindex="-1">安全建议 <a class="header-anchor" href="#安全建议" aria-label="Permalink to &quot;安全建议&quot;">​</a></h2><ol><li><strong>保护敏感信息</strong>：不要在代码中硬编码密钥，使用环境变量</li><li><strong>定期更新依赖</strong>：运行 <code>pip install --upgrade</code> 和 <code>npm update</code></li><li><strong>使用版本标签</strong>：生产环境避免使用 <code>latest</code>，使用具体版本号</li><li><strong>限制网络访问</strong>：配置防火墙规则，只开放必要端口</li><li><strong>启用 HTTPS</strong>：生产环境使用反向代理（如 Nginx）并配置 SSL 证书</li></ol><h2 id="相关文档" tabindex="-1">相关文档 <a class="header-anchor" href="#相关文档" aria-label="Permalink to &quot;相关文档&quot;">​</a></h2><ul><li><a href="https://docs.docker.com/compose/" target="_blank" rel="noreferrer">Docker Compose 文档</a></li><li><a href="https://docs.github.com/actions" target="_blank" rel="noreferrer">GitHub Actions 文档</a></li><li><a href="https://docs.github.com/packages" target="_blank" rel="noreferrer">GitHub Packages 文档</a></li></ul>`,85)]))}const g=a(l,[["render",t]]);export{c as __pageData,g as default};
