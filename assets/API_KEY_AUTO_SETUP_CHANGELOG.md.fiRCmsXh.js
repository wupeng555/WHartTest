import{_ as a,c as i,o as t,ae as e}from"./chunks/framework.BBQ6_s69.js";const c=JSON.parse('{"title":"API Key 自动配置功能 - 变更说明","description":"","frontmatter":{},"headers":[],"relativePath":"API_KEY_AUTO_SETUP_CHANGELOG.md","filePath":"API_KEY_AUTO_SETUP_CHANGELOG.md","lastUpdated":1763522166000}'),n={name:"API_KEY_AUTO_SETUP_CHANGELOG.md"};function l(h,s,p,r,d,o){return t(),i("div",null,s[0]||(s[0]=[e(`<h1 id="api-key-自动配置功能-变更说明" tabindex="-1">API Key 自动配置功能 - 变更说明 <a class="header-anchor" href="#api-key-自动配置功能-变更说明" aria-label="Permalink to &quot;API Key 自动配置功能 - 变更说明&quot;">​</a></h1><h2 id="📋-变更概述" tabindex="-1">📋 变更概述 <a class="header-anchor" href="#📋-变更概述" aria-label="Permalink to &quot;📋 变更概述&quot;">​</a></h2><p>解决了MCP服务启动时的API Key循环依赖问题，实现<strong>开箱即用</strong>的默认配置方案。</p><h2 id="✨-新功能" tabindex="-1">✨ 新功能 <a class="header-anchor" href="#✨-新功能" aria-label="Permalink to &quot;✨ 新功能&quot;">​</a></h2><h3 id="_1-自动创建默认api-key" tabindex="-1">1. 自动创建默认API Key <a class="header-anchor" href="#_1-自动创建默认api-key" aria-label="Permalink to &quot;1. 自动创建默认API Key&quot;">​</a></h3><ul><li><strong>固定Key值</strong>: <code>wharttest-default-mcp-key-2025</code></li><li><strong>自动创建</strong>: 后端首次启动时通过 <code>init_admin</code> 命令自动生成</li><li><strong>Key名称</strong>: &quot;Default MCP Key (Auto-generated)&quot;</li><li><strong>描述</strong>: 包含安全提示，提醒生产环境更换</li></ul><h3 id="_2-自动创建默认mcp配置" tabindex="-1">2. 自动创建默认MCP配置 <a class="header-anchor" href="#_2-自动创建默认mcp配置" aria-label="Permalink to &quot;2. 自动创建默认MCP配置&quot;">​</a></h3><p>系统会自动创建两个远程MCP配置：</p><table tabindex="0"><thead><tr><th>配置名称</th><th>URL</th><th>说明</th></tr></thead><tbody><tr><td>WHartTest-Tools</td><td><a href="http://mcp:8006" target="_blank" rel="noreferrer">http://mcp:8006</a></td><td>测试用例管理工具</td></tr><tr><td>Playwright-MCP</td><td><a href="http://playwright-mcp:8931/mcp" target="_blank" rel="noreferrer">http://playwright-mcp:8931/mcp</a></td><td>浏览器自动化工具</td></tr></tbody></table><p>用户无需手动添加MCP配置，开箱即用</p><h3 id="_2-零配置启动" tabindex="-1">2. 零配置启动 <a class="header-anchor" href="#_2-零配置启动" aria-label="Permalink to &quot;2. 零配置启动&quot;">​</a></h3><p>开发环境无需任何手动配置：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env.example</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 配置文件已包含默认Key</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     # 直接启动</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># MCP服务立即可用！</span></span></code></pre></div><h3 id="_3-环境变量默认值" tabindex="-1">3. 环境变量默认值 <a class="header-anchor" href="#_3-环境变量默认值" aria-label="Permalink to &quot;3. 环境变量默认值&quot;">​</a></h3><p>所有配置文件都已更新为包含默认Key：</p><ul><li><code>.env.example</code> - 根目录</li><li><code>WHartTest_MCP/.env.example</code> - MCP目录</li><li><code>docker-compose.yml</code> - Docker配置</li></ul><h2 id="🔧-修改的文件" tabindex="-1">🔧 修改的文件 <a class="header-anchor" href="#🔧-修改的文件" aria-label="Permalink to &quot;🔧 修改的文件&quot;">​</a></h2><h3 id="后端修改" tabindex="-1">后端修改 <a class="header-anchor" href="#后端修改" aria-label="Permalink to &quot;后端修改&quot;">​</a></h3><p><strong>文件</strong>: <code>WHartTest_Django/accounts/management/commands/init_admin.py</code></p><p><strong>改动</strong>:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 新增：自动创建默认API Key</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> api_keys.models </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APIKey</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">default_api_key_value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;wharttest-default-mcp-key-2025&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">APIKey.objects.create(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">admin_user,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Default MCP Key (Auto-generated)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">default_api_key_value,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    is_active</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;系统自动生成的默认MCP服务密钥...&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="配置文件修改" tabindex="-1">配置文件修改 <a class="header-anchor" href="#配置文件修改" aria-label="Permalink to &quot;配置文件修改&quot;">​</a></h3><p><strong>文件</strong>: <code>.env.example</code> (根目录)</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 旧值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">WHARTTEST_API_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your_api_key_here</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 新值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">WHARTTEST_API_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">wharttest-default-mcp-key-2025</span></span></code></pre></div><p><strong>文件</strong>: <code>WHartTest_MCP/.env.example</code></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 旧值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">WHARTTEST_API_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your_api_key_here</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 新值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">WHARTTEST_API_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">wharttest-default-mcp-key-2025</span></span></code></pre></div><p><strong>文件</strong>: <code>docker-compose.yml</code></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 旧值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">WHARTTEST_API_KEY=\${WHARTTEST_API_KEY:-}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 新值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">WHARTTEST_API_KEY=\${WHARTTEST_API_KEY:-wharttest-default-mcp-key-2025}</span></span></code></pre></div><h3 id="文档更新" tabindex="-1">文档更新 <a class="header-anchor" href="#文档更新" aria-label="Permalink to &quot;文档更新&quot;">​</a></h3><ol><li><strong>README.md</strong> - 添加&quot;开箱即用&quot;说明和快速启动链接</li><li><strong>WHartTest_MCP/README.md</strong> - 更新配置说明，强调零配置特性</li><li><strong>docs/QUICK_START.md</strong> - 新建快速启动指南</li></ol><h2 id="🎯-使用场景" tabindex="-1">🎯 使用场景 <a class="header-anchor" href="#🎯-使用场景" aria-label="Permalink to &quot;🎯 使用场景&quot;">​</a></h2><h3 id="开发环境-推荐默认key" tabindex="-1">开发环境（推荐默认Key） <a class="header-anchor" href="#开发环境-推荐默认key" aria-label="Permalink to &quot;开发环境（推荐默认Key）&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 克隆项目</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xxx</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> WHartTest</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 准备配置（使用默认Key）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env.example</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 启动</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ✅ 完成！MCP服务立即可用</span></span></code></pre></div><h3 id="生产环境-必须更换key" tabindex="-1">生产环境（必须更换Key） <a class="header-anchor" href="#生产环境-必须更换key" aria-label="Permalink to &quot;生产环境（必须更换Key）&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1-3. 同开发环境</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. 登录后台更换Key</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 访问: http://your-domain/admin</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 进入: 系统管理 &gt; API密钥</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 操作: 删除默认Key，创建新Key</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 5. 更新配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># WHARTTEST_API_KEY=新创建的安全密钥</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 6. 重启MCP服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mcp</span></span></code></pre></div><h2 id="🔒-安全考虑" tabindex="-1">🔒 安全考虑 <a class="header-anchor" href="#🔒-安全考虑" aria-label="Permalink to &quot;🔒 安全考虑&quot;">​</a></h2><h3 id="优点" tabindex="-1">优点 <a class="header-anchor" href="#优点" aria-label="Permalink to &quot;优点&quot;">​</a></h3><ul><li>✅ 开发环境零配置，提高开发体验</li><li>✅ 保留了API Key验证机制，不降低安全性</li><li>✅ 默认Key有明确的安全提示</li><li>✅ 生产环境可轻松更换为安全密钥</li></ul><h3 id="安全措施" tabindex="-1">安全措施 <a class="header-anchor" href="#安全措施" aria-label="Permalink to &quot;安全措施&quot;">​</a></h3><ol><li><strong>Key名称标识</strong>: &quot;Default MCP Key (Auto-generated)&quot; 便于识别</li><li><strong>描述提示</strong>: 明确提示生产环境必须更换</li><li><strong>文档强调</strong>: 所有文档都强调生产环境安全要求</li><li><strong>可追溯性</strong>: 通过后台可以看到所有Key的使用情况</li></ol><h3 id="潜在风险" tabindex="-1">潜在风险 <a class="header-anchor" href="#潜在风险" aria-label="Permalink to &quot;潜在风险&quot;">​</a></h3><p>⚠️ <strong>固定默认Key的风险</strong>:</p><ul><li>所有人都知道默认Key值</li><li>如果生产环境不更换，存在安全隐患</li></ul><p><strong>缓解措施</strong>:</p><ul><li>文档多处强调必须更换</li><li>后台管理界面有明显标识</li><li>建议在CI/CD中添加检查，禁止使用默认Key部署生产环境</li></ul><h2 id="📊-对比" tabindex="-1">📊 对比 <a class="header-anchor" href="#📊-对比" aria-label="Permalink to &quot;📊 对比&quot;">​</a></h2><h3 id="修改前" tabindex="-1">修改前 <a class="header-anchor" href="#修改前" aria-label="Permalink to &quot;修改前&quot;">​</a></h3><table tabindex="0"><thead><tr><th>步骤</th><th>操作</th><th>耗时</th></tr></thead><tbody><tr><td>1</td><td>启动后端</td><td>1min</td></tr><tr><td>2</td><td>登录后台</td><td>1min</td></tr><tr><td>3</td><td>创建API Key</td><td>2min</td></tr><tr><td>4</td><td>配置.env</td><td>1min</td></tr><tr><td>5</td><td>启动MCP</td><td>1min</td></tr><tr><td><strong>总计</strong></td><td><strong>5个手动步骤</strong></td><td><strong>6分钟</strong></td></tr></tbody></table><h3 id="修改后" tabindex="-1">修改后 <a class="header-anchor" href="#修改后" aria-label="Permalink to &quot;修改后&quot;">​</a></h3><table tabindex="0"><thead><tr><th>步骤</th><th>操作</th><th>耗时</th></tr></thead><tbody><tr><td>1</td><td>复制.env</td><td>10s</td></tr><tr><td>2</td><td>启动所有服务</td><td>1min</td></tr><tr><td><strong>总计</strong></td><td><strong>2个步骤</strong></td><td><strong>1分钟</strong></td></tr></tbody></table><p><strong>效率提升</strong>: 节省 <strong>83%</strong> 的配置时间</p><h2 id="🧪-测试建议" tabindex="-1">🧪 测试建议 <a class="header-anchor" href="#🧪-测试建议" aria-label="Permalink to &quot;🧪 测试建议&quot;">​</a></h2><h3 id="功能测试" tabindex="-1">功能测试 <a class="header-anchor" href="#功能测试" aria-label="Permalink to &quot;功能测试&quot;">​</a></h3><ol><li>✅ 全新部署测试默认Key是否自动创建</li><li>✅ MCP服务能否正常调用后端API</li><li>✅ 删除默认Key后创建新Key能否正常工作</li><li>✅ 更换Key后重启MCP服务是否生效</li></ol><h3 id="安全测试" tabindex="-1">安全测试 <a class="header-anchor" href="#安全测试" aria-label="Permalink to &quot;安全测试&quot;">​</a></h3><ol><li>⚠️ 确认默认Key在数据库中正确存储</li><li>⚠️ 确认API Key验证逻辑没有被绕过</li><li>⚠️ 测试无效Key是否正确拒绝访问</li></ol><h2 id="🔄-回滚方案" tabindex="-1">🔄 回滚方案 <a class="header-anchor" href="#🔄-回滚方案" aria-label="Permalink to &quot;🔄 回滚方案&quot;">​</a></h2><p>如果需要回滚到手动配置方式：</p><ol><li>修改 <code>init_admin.py</code>，移除自动创建Key的代码</li><li>恢复 <code>.env.example</code> 中的 <code>WHARTTEST_API_KEY=your_api_key_here</code></li><li>修改 <code>docker-compose.yml</code>，设置 <code>WHARTTEST_API_KEY=\${WHARTTEST_API_KEY:-}</code></li><li>更新文档，恢复手动配置说明</li></ol><h2 id="📝-后续改进建议" tabindex="-1">📝 后续改进建议 <a class="header-anchor" href="#📝-后续改进建议" aria-label="Permalink to &quot;📝 后续改进建议&quot;">​</a></h2><ol><li><strong>CI/CD集成</strong>: 添加检查，禁止默认Key部署到生产环境</li><li><strong>健康检查</strong>: 在启动时检查是否使用默认Key，生产环境发出警告</li><li><strong>Key轮换</strong>: 实现自动Key轮换机制</li><li><strong>权限细化</strong>: 为MCP服务创建专用的受限权限Key</li></ol><h2 id="🎉-总结" tabindex="-1">🎉 总结 <a class="header-anchor" href="#🎉-总结" aria-label="Permalink to &quot;🎉 总结&quot;">​</a></h2><p>此次改动极大简化了开发环境的配置流程，同时保持了生产环境的安全性和灵活性。开发者可以在1分钟内启动完整的系统，而不需要理解复杂的API Key配置过程。</p>`,63)]))}const g=a(n,[["render",l]]);export{c as __pageData,g as default};
